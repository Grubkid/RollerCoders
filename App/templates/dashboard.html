{% extends 'dashboard_layout.html' %}

{% block content %}
<div style="display: flex;">

    <!-- ‚úÖ LEFT SIDEBAR: Fixed, scrollable white panel -->
    <aside class="ingredient-sidebar">
        <h3>Ingredients</h3>

        <!-- Search + Show All -->
        <div class="ingredient-controls">
            <form method="GET" action="{{ url_for('ingredient_views.dashboard') }}">
                <button type="submit" class="btn btn-outline">Show All</button>
            </form>
            <form method="POST" action="{{ url_for('ingredient_views.dashboard') }}" style="display: flex; flex: 1;">
                <input type="text" name="query" placeholder="Search‚Ä¶" required>
                <button type="submit" class="btn btn-primary" style="margin-left: 0.3rem;">üîç</button>
            </form>
        </div>

        {% if search_error %}
        <div style="color: red; font-weight: 600; margin-bottom: 0.5rem;">
            BigBack{{ username }}, that ingredient is not available for search.
        </div>
        {% endif %}

        <div class="ingredient-list">
            {% for ing in search_results %}
            <div class="ingredient-item" onclick="toggleActions(this)">
                {{ ing.strIngredient }}
                <div class="ingredient-actions">
                    <form method="POST" action="{{ url_for('ingredient_views.add_ingredient_view') }}">
                        <input type="hidden" name="ingredient_id" value="{{ ing.idIngredient }}">
                        <input type="hidden" name="name" value="{{ ing.strIngredient }}">
                        <input type="number" name="quantity" value="1" min="1">
                        <button type="submit" class="btn btn-primary">Add</button>
                    </form>
                    {% if ing.idIngredient in user_ingredient_ids %}
                    <form method="POST" action="{{ url_for('ingredient_views.remove_ingredient_view') }}">
                        <input type="hidden" name="ingredient_id" value="{{ ing.idIngredient }}">
                        <button type="submit" class="btn btn-outline">Remove</button>
                    </form>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </aside>

    <!-- Main: Inventory -->
    <div style="flex-grow: 1; padding: 1em;">
        <h2>My Inventory</h2>
        <ul>
            {% for ing in user_ingredients %}
            <li>
                {{ ing.name }} - Quantity: {{ ing.quantity }}
                <form method="POST" action="{{ url_for('ingredient_views.remove_ingredient_view') }}">
                    <input type="hidden" name="ingredient_id" value="{{ ing.ingredient_id }}">
                    <button type="submit">Remove</button>
                </form>
            </li>
            {% endfor %}
        </ul>
    </div>
</div>

<!-- Toggle Script -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const toggleBtn = document.getElementById("toggle-ingredients-btn");
        const ingredientsSection = document.getElementById("ingredients-section");

        toggleBtn.addEventListener("click", () => {
            const isVisible = ingredientsSection.style.display === "block";
            ingredientsSection.style.display = isVisible ? "none" : "block";
        });
    });
</script>
{% endblock %}